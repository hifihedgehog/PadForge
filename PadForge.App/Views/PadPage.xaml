<UserControl x:Class="PadForge.Views.PadPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PadForge.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:PadViewModel}"
             d:DesignHeight="700" d:DesignWidth="900">

    <UserControl.Resources>
        <!-- Style for dead zone slider groups -->
        <Style x:Key="DzLabel" TargetType="TextBlock">
            <Setter Property="Width" Value="110"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
        </Style>
        <Style x:Key="DzSlider" TargetType="Slider">
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="100"/>
            <Setter Property="Width" Value="200"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="IsSnapToTickEnabled" Value="True"/>
            <Setter Property="TickFrequency" Value="1"/>
        </Style>
        <Style x:Key="DzValue" TargetType="TextBlock">
            <Setter Property="Width" Value="35"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextAlignment" Value="Right"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
            <Setter Property="Margin" Value="4,0,0,0"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <!-- Row 0: Device selector header -->
            <RowDefinition Height="Auto"/>
            <!-- Row 1: Configuration tabs -->
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ═══════════════════════════════════════════
             ROW 0: Device Selector Header
             Selects which physical device to configure within this pad slot.
             Like x360ce's device list above the mapping grid.
             ═══════════════════════════════════════════ -->
        <Border Grid.Row="0" Padding="8" Margin="0,0,0,4"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding SlotLabel}"
                           FontSize="16" FontWeight="SemiBold"
                           VerticalAlignment="Center" Margin="0,0,12,0"
                           Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                <!-- Device ComboBox: select which mapped device to configure -->
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding MappedDevices}"
                          SelectedItem="{Binding SelectedMappedDevice, Mode=TwoWay}"
                          MinWidth="250"
                          VerticalAlignment="Center">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="8" Height="8" Margin="0,0,6,0"
                                         VerticalAlignment="Center">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="#FF888888"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsOnline}" Value="True">
                                                    <Setter Property="Fill" Value="#FF4CAF50"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock Text="{Binding Name}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Online status indicator -->
                <StackPanel Grid.Column="2" Orientation="Horizontal"
                            VerticalAlignment="Center" Margin="12,0,0,0">
                    <Ellipse Width="10" Height="10" Margin="0,0,6,0">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#FF888888"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDeviceOnline}" Value="True">
                                        <Setter Property="Fill" Value="#FF4CAF50"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock VerticalAlignment="Center"
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="Offline"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDeviceOnline}" Value="True">
                                        <Setter Property="Text" Value="Online"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ═══════════════════════════════════════════
             ROW 1: Configuration TabControl
             Tabs: Controller | Mappings | Left Stick | Right Stick | Triggers | Force Feedback | Macros
             ═══════════════════════════════════════════ -->
        <TabControl Grid.Row="1"
                    SelectedIndex="{Binding SelectedConfigTab, Mode=TwoWay}">

            <!-- ─── TAB 0: Controller ─── -->
            <TabItem Header="Controller">
                <Viewbox Stretch="Uniform" Margin="4">
                    <StackPanel Width="768" HorizontalAlignment="Center">

                        <!-- ══════════════════════════════════════
                             TOP VIEW: Triggers + Bumpers
                             ══════════════════════════════════════ -->
                        <Grid Width="768" Height="432" Margin="0,4,0,1">
                                <Image Source="/Resources/Xbox Series Controller - Top.png" Stretch="Fill"/>
                                <Canvas Width="768" Height="432">

                                    <!-- LT trigger fill -->
                                    <Border Canvas.Left="145" Canvas.Top="180" Width="93" Height="98"
                                            Background="#30000000" CornerRadius="5" HorizontalAlignment="Left" VerticalAlignment="Top">
                                        <Grid VerticalAlignment="Bottom">
                                            <Rectangle Fill="#40FF9800" RadiusX="4" RadiusY="4"
                                                       Width="93" HorizontalAlignment="Center"
                                                       VerticalAlignment="Bottom"
                                                       Height="{Binding LeftTrigger,
                                                           Converter={StaticResource NormToTriggerHeightConverter},
                                                           ConverterParameter=94}"/>
                                        </Grid>
                                    </Border>

                                    <!-- RT trigger fill -->
                                    <Border Canvas.Left="529" Canvas.Top="180" Width="93" Height="98"
                                            Background="#30000000" CornerRadius="5" HorizontalAlignment="Left" VerticalAlignment="Top">
                                        <Grid VerticalAlignment="Bottom">
                                            <Rectangle Fill="#40FF9800" RadiusX="4" RadiusY="4"
                                                       Width="93" HorizontalAlignment="Center"
                                                       VerticalAlignment="Bottom"
                                                       Height="{Binding RightTrigger,
                                                           Converter={StaticResource NormToTriggerHeightConverter},
                                                           ConverterParameter=94}"/>
                                        </Grid>
                                    </Border>

                                    <!-- Left shoulder rectangle -->
                                    <Border Canvas.Left="149" Canvas.Top="278" Width="142" Height="72" CornerRadius="6"
                                            Background="#FF607D8B"
                                            Opacity="{Binding LeftShoulder, Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6' }"/>

                                    <!-- Right shoulder rectangle -->
                                    <Border Canvas.Left="477" Canvas.Top="278" Width="142" Height="72" CornerRadius="6"
                                            Background="#FF607D8B"
                                            Opacity="{Binding RightShoulder, Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6' }"/>

                                    <!-- LB bumper highlight -->

                                    <!-- RB bumper highlight -->

                                </Canvas>
                        </Grid>

                        <!-- ══════════════════════════════════════
                             FRONT VIEW: Sticks, Buttons, D-Pad, Center
                             ══════════════════════════════════════ -->
                        <Grid Width="768" Height="588" ClipToBounds="True" Margin="0,1,0,2">
                                <Image Source="/Resources/Xbox Series Controller - Front.png" Stretch="Fill" RenderTransformOrigin="0.494,0.495"/>
                                <Canvas Width="768" Height="588">

                                    <!-- ── LEFT STICK ── -->
                                    <Canvas Canvas.Left="190" Canvas.Top="158" Width="84" Height="84" ClipToBounds="True">
                                        <Ellipse Width="84" Height="84" Fill="#40000000"
                                                 Stroke="#60FFFFFF" StrokeThickness="1.5"/>
                                        <Ellipse Width="45" Height="45" Fill="#FF2196F3"
                                                 Stroke="#FF1976D2" StrokeThickness="1.5"
                                                 Canvas.Left="{Binding ThumbLX,
                                                     Converter={StaticResource NormToCanvasConverter}, ConverterParameter='84,45'}"
                                                 Canvas.Top="{Binding ThumbLY,
                                                     Converter={StaticResource NormToCanvasConverter}, ConverterParameter='84,45'}"/>
                                    </Canvas>
                                    <!-- LS click glow -->
                                    <Ellipse Canvas.Left="190" Canvas.Top="158" Width="84" Height="84"
                                             Fill="Transparent" Stroke="#FF2196F3" StrokeThickness="3"
                                             Opacity="{Binding LeftThumbButton,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0,0.7'}"/>

                                    <!-- ── RIGHT STICK ── -->
                                    <Canvas Canvas.Left="421" Canvas.Top="250" Width="84" Height="84" ClipToBounds="True">
                                        <Ellipse Width="84" Height="84" Fill="#40000000"
                                                 Stroke="#60FFFFFF" StrokeThickness="1.5"/>
                                        <Ellipse Width="45" Height="45" Fill="#FF2196F3"
                                                 Stroke="#FF1976D2" StrokeThickness="1.5"
                                                 Canvas.Left="{Binding ThumbRX,
                                                     Converter={StaticResource NormToCanvasConverter}, ConverterParameter='84,45'}"
                                                 Canvas.Top="{Binding ThumbRY,
                                                     Converter={StaticResource NormToCanvasConverter}, ConverterParameter='84,45'}"/>
                                    </Canvas>
                                    <!-- RS click glow -->
                                    <Ellipse Canvas.Left="421" Canvas.Top="250" Width="84" Height="84"
                                             Fill="Transparent" Stroke="#FF2196F3" StrokeThickness="3"
                                             Opacity="{Binding RightThumbButton,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0,0.7'}"/>

                                    <!-- ── D-PAD DIRECTION HIGHLIGHTS ── -->
                                    <Rectangle Canvas.Left="291" Canvas.Top="255" Width="30" Height="30"
                                               Fill="#FF4CAF50" RadiusX="3" RadiusY="3"
                                               Opacity="{Binding DPadUp,
                                                   Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0,0.6'}" HorizontalAlignment="Center" VerticalAlignment="Top"/>
                                    <Rectangle Canvas.Left="291" Canvas.Top="314" Width="30" Height="30"
                                               Fill="#FF4CAF50" RadiusX="3" RadiusY="3"
                                               Opacity="{Binding DPadDown,
                                                   Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0,0.6'}" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                    <Rectangle Canvas.Left="260" Canvas.Top="284" Width="30" Height="30"
                                               Fill="#FF4CAF50" RadiusX="3" RadiusY="3"
                                               Opacity="{Binding DPadLeft,
                                                   Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0,0.6'}" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                    <Rectangle Canvas.Left="321" Canvas.Top="284" Width="30" Height="30"
                                               Fill="#FF4CAF50" RadiusX="3" RadiusY="3"
                                               Opacity="{Binding DPadRight,
                                                   Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0,0.6'}" HorizontalAlignment="Center" VerticalAlignment="Top"/>

                                    <!-- ── ABXY BUTTONS ── -->
                                    <!-- A (bottom, green) -->
                                    <Ellipse Canvas.Left="517" Canvas.Top="222" Width="40" Height="40"
                                             Fill="#FF4CAF50"
                                             Opacity="{Binding ButtonA,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}" HorizontalAlignment="Center" VerticalAlignment="Top"/>

                                    <!-- B (right, red) -->
                                    <Ellipse Canvas.Left="558" Canvas.Top="184" Width="40" Height="40"
                                             Fill="#FFF44336"
                                             Opacity="{Binding ButtonB,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}" HorizontalAlignment="Left" VerticalAlignment="Center"/>

                                    <!-- X (left, blue) -->
                                    <Ellipse Canvas.Left="477" Canvas.Top="182" Width="40" Height="40"
                                             Fill="#FF2196F3"
                                             Opacity="{Binding ButtonX,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}" HorizontalAlignment="Center" VerticalAlignment="Top"/>

                                    <!-- Y (top, yellow) -->
                                    <Ellipse Canvas.Left="517" Canvas.Top="143" Width="40" Height="40"
                                             Fill="#FFFFEB3B"
                                             Opacity="{Binding ButtonY,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}" HorizontalAlignment="Left" VerticalAlignment="Center"/>

                                    <!-- ── CENTER BUTTONS ── -->
                                    <!-- Guide (Xbox logo) -->
                                    <Ellipse Canvas.Left="360" Canvas.Top="116" Width="50" Height="50"
                                             Fill="#FF7B1FA2"
                                             Opacity="{Binding ButtonGuide,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}" HorizontalAlignment="Center" VerticalAlignment="Top"/>

                                    <!-- View (Back) -->
                                    <Ellipse Canvas.Left="327" Canvas.Top="188" Width="26" Height="26"
                                             Fill="#FF607D8B"
                                             Opacity="{Binding ButtonBack,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}"/>

                                    <!-- Menu (Start) -->
                                    <Ellipse Canvas.Left="415" Canvas.Top="188" Width="26" Height="26"
                                             Fill="#FF607D8B"
                                             Opacity="{Binding ButtonStart,
                                                 Converter={StaticResource BoolToOpacityConverter}, ConverterParameter='0.1,0.6'}"/>

                                </Canvas>
                        </Grid>

                        <!-- ══════════════════════════════════════
                             MOTOR ACTIVITY INDICATORS
                             ══════════════════════════════════════ -->
                        <Grid Width="500" Margin="0,0,0,4" HorizontalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="24"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="L Motor" FontSize="10"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           HorizontalAlignment="Center" Margin="0,0,0,2"/>
                                <Border Height="10" Background="#FF1E1E21" CornerRadius="3"
                                        BorderBrush="#FF3F3F46" BorderThickness="1">
                                    <Rectangle Fill="#FF9C27B0" RadiusX="2" RadiusY="2"
                                               HorizontalAlignment="Left"
                                               Width="{Binding LeftMotorDisplay,
                                                   Converter={StaticResource NormToTriggerHeightConverter},
                                                   ConverterParameter=240}"/>
                                </Border>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="R Motor" FontSize="10"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           HorizontalAlignment="Center" Margin="0,0,0,2"/>
                                <Border Height="10" Background="#FF1E1E21" CornerRadius="3"
                                        BorderBrush="#FF3F3F46" BorderThickness="1">
                                    <Rectangle Fill="#FF9C27B0" RadiusX="2" RadiusY="2"
                                               HorizontalAlignment="Left"
                                               Width="{Binding RightMotorDisplay,
                                                   Converter={StaticResource NormToTriggerHeightConverter},
                                                   ConverterParameter=240}"/>
                                </Border>
                            </StackPanel>
                        </Grid>

                    </StackPanel>
                </Viewbox>
            </TabItem>

            <!-- ─── TAB 1: Mappings ─── -->
            <TabItem Header="Mappings">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Toolbar -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Clear All" Command="{Binding ClearMappingsCommand}"
                                Padding="8,4" Margin="0,0,8,0"/>
                        <TextBlock Text="Click a mapping row and press a button/axis on your controller to assign it."
                                   VerticalAlignment="Center" FontStyle="Italic"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>

                    <!-- Mapping DataGrid -->
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Mappings}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserReorderColumns="False"
                              SelectionMode="Single"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              IsReadOnly="True"
                              VerticalScrollBarVisibility="Auto">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="XInput Output"
                                                Binding="{Binding TargetLabel}"
                                                Width="130"/>
                            <DataGridTextColumn Header="Source"
                                                Binding="{Binding SourceDisplayText}"
                                                Width="140"/>
                            <DataGridTextColumn Header="Value"
                                                Binding="{Binding CurrentValueText, Mode=OneWay}"
                                                Width="60"/>
                            <!-- Record button -->
                            <DataGridTemplateColumn Header="" Width="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{Binding RecordButtonText}"
                                                Command="{Binding ToggleRecordCommand}"
                                                Padding="6,2" Margin="2"
                                                MinWidth="75" HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!-- Clear button -->
                            <DataGridTemplateColumn Header="" Width="55">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Clear"
                                                Command="{Binding ClearCommand}"
                                                Padding="4,2" Margin="2"
                                                HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!-- Invert / Half-axis options -->
                            <DataGridTemplateColumn Header="Options" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <CheckBox Content="Inv" IsChecked="{Binding IsInverted, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      Margin="0,0,6,0" VerticalAlignment="Center"/>
                                            <CheckBox Content="Half" IsChecked="{Binding IsHalfAxis, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ─── TAB 1: Left Stick ─── -->
            <TabItem Header="Left Stick">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
                    <StackPanel>
                        <TextBlock Text="Left Thumbstick Configuration"
                                   FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                        <!-- Dead Zone X -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Dead Zone X:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftDeadZoneX, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftDeadZoneX, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Dead Zone Y -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Dead Zone Y:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftDeadZoneY, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftDeadZoneY, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Anti-Dead Zone -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Anti-Dead Zone:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftAntiDeadZone, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftAntiDeadZone, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Linear (response curve) -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Linear:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftLinear, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftLinear, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <Separator Margin="0,8,0,12"/>

                        <!-- Live preview -->
                        <TextBlock Text="Live Preview" FontWeight="SemiBold" Margin="0,0,0,8"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                        <Grid Width="200" Height="200" HorizontalAlignment="Left">
                            <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1" CornerRadius="100"
                                    Background="{DynamicResource ControlFillColorDefaultBrush}">
                                <Canvas ClipToBounds="True">
                                    <!-- Boundary circle -->
                                    <Ellipse Width="196" Height="196" Canvas.Left="2" Canvas.Top="2"
                                             Stroke="{DynamicResource ControlStrokeColorDefaultBrush}"
                                             StrokeThickness="1.5" Fill="Transparent"/>
                                    <!-- 50% range ring -->
                                    <Ellipse Width="98" Height="98" Canvas.Left="51" Canvas.Top="51"
                                             Stroke="{DynamicResource ControlStrokeColorSecondaryBrush}"
                                             StrokeDashArray="4 2" StrokeThickness="0.5" Fill="Transparent"/>
                                    <!-- Dead zone ring (scaled by LeftDeadZoneX — max 200px diameter at 100%) -->
                                    <Ellipse Fill="#18FF5722" Stroke="#60FF5722" StrokeThickness="1"
                                             HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <Ellipse.Width>
                                            <Binding Path="LeftDeadZoneX" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="200"/>
                                        </Ellipse.Width>
                                        <Ellipse.Height>
                                            <Binding Path="LeftDeadZoneY" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="200"/>
                                        </Ellipse.Height>
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform>
                                                <TranslateTransform.X>
                                                    <Binding Path="LeftDeadZoneX" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="-100"/>
                                                </TranslateTransform.X>
                                                <TranslateTransform.Y>
                                                    <Binding Path="LeftDeadZoneY" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="-100"/>
                                                </TranslateTransform.Y>
                                            </TranslateTransform>
                                        </Ellipse.RenderTransform>
                                        <Canvas.Left>100</Canvas.Left>
                                        <Canvas.Top>100</Canvas.Top>
                                    </Ellipse>
                                    <!-- Crosshair -->
                                    <Line X1="100" Y1="0" X2="100" Y2="200"
                                          Stroke="{DynamicResource ControlStrokeColorSecondaryBrush}"
                                          StrokeThickness="0.5"/>
                                    <Line X1="0" Y1="100" X2="200" Y2="100"
                                          Stroke="{DynamicResource ControlStrokeColorSecondaryBrush}"
                                          StrokeThickness="0.5"/>
                                    <!-- Stick position dot -->
                                    <Ellipse Width="14" Height="14" Fill="#FF2196F3"
                                             Stroke="#FF1976D2" StrokeThickness="1.5"
                                             Canvas.Left="{Binding ThumbLX, Converter={StaticResource NormToCanvasConverter}, ConverterParameter=200}"
                                             Canvas.Top="{Binding ThumbLY, Converter={StaticResource NormToCanvasConverter}, ConverterParameter=200}"/>
                                </Canvas>
                            </Border>
                        </Grid>
                        <TextBlock Margin="0,4,0,0"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                            <Run Text="X:"/>
                            <Run Text="{Binding RawThumbLX, Mode=OneWay}"/>
                            <Run Text="  Y:"/>
                            <Run Text="{Binding RawThumbLY, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ─── TAB 2: Right Stick ─── -->
            <TabItem Header="Right Stick">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
                    <StackPanel>
                        <TextBlock Text="Right Thumbstick Configuration"
                                   FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                        <!-- Dead Zone X -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Dead Zone X:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightDeadZoneX, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightDeadZoneX, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Dead Zone Y -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Dead Zone Y:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightDeadZoneY, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightDeadZoneY, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Anti-Dead Zone -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Anti-Dead Zone:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightAntiDeadZone, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightAntiDeadZone, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Linear -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Linear:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightLinear, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightLinear, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <Separator Margin="0,8,0,12"/>

                        <!-- Live preview -->
                        <TextBlock Text="Live Preview" FontWeight="SemiBold" Margin="0,0,0,8"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                        <Grid Width="200" Height="200" HorizontalAlignment="Left">
                            <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1" CornerRadius="100"
                                    Background="{DynamicResource ControlFillColorDefaultBrush}">
                                <Canvas ClipToBounds="True">
                                    <!-- Boundary circle -->
                                    <Ellipse Width="196" Height="196" Canvas.Left="2" Canvas.Top="2"
                                             Stroke="{DynamicResource ControlStrokeColorDefaultBrush}"
                                             StrokeThickness="1.5" Fill="Transparent"/>
                                    <!-- 50% range ring -->
                                    <Ellipse Width="98" Height="98" Canvas.Left="51" Canvas.Top="51"
                                             Stroke="{DynamicResource ControlStrokeColorSecondaryBrush}"
                                             StrokeDashArray="4 2" StrokeThickness="0.5" Fill="Transparent"/>
                                    <!-- Dead zone ring -->
                                    <Ellipse Fill="#18FF5722" Stroke="#60FF5722" StrokeThickness="1"
                                             HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <Ellipse.Width>
                                            <Binding Path="RightDeadZoneX" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="200"/>
                                        </Ellipse.Width>
                                        <Ellipse.Height>
                                            <Binding Path="RightDeadZoneY" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="200"/>
                                        </Ellipse.Height>
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform>
                                                <TranslateTransform.X>
                                                    <Binding Path="RightDeadZoneX" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="-100"/>
                                                </TranslateTransform.X>
                                                <TranslateTransform.Y>
                                                    <Binding Path="RightDeadZoneY" Converter="{StaticResource PercentToSizeConverter}" ConverterParameter="-100"/>
                                                </TranslateTransform.Y>
                                            </TranslateTransform>
                                        </Ellipse.RenderTransform>
                                        <Canvas.Left>100</Canvas.Left>
                                        <Canvas.Top>100</Canvas.Top>
                                    </Ellipse>
                                    <!-- Crosshair -->
                                    <Line X1="100" Y1="0" X2="100" Y2="200"
                                          Stroke="{DynamicResource ControlStrokeColorSecondaryBrush}"
                                          StrokeThickness="0.5"/>
                                    <Line X1="0" Y1="100" X2="200" Y2="100"
                                          Stroke="{DynamicResource ControlStrokeColorSecondaryBrush}"
                                          StrokeThickness="0.5"/>
                                    <!-- Stick position dot -->
                                    <Ellipse Width="14" Height="14" Fill="#FF2196F3"
                                             Stroke="#FF1976D2" StrokeThickness="1.5"
                                             Canvas.Left="{Binding ThumbRX, Converter={StaticResource NormToCanvasConverter}, ConverterParameter=200}"
                                             Canvas.Top="{Binding ThumbRY, Converter={StaticResource NormToCanvasConverter}, ConverterParameter=200}"/>
                                </Canvas>
                            </Border>
                        </Grid>
                        <TextBlock Margin="0,4,0,0"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                            <Run Text="X:"/>
                            <Run Text="{Binding RawThumbRX, Mode=OneWay}"/>
                            <Run Text="  Y:"/>
                            <Run Text="{Binding RawThumbRY, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ─── TAB 3: Triggers ─── -->
            <TabItem Header="Triggers">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
                    <StackPanel>
                        <!-- Left Trigger -->
                        <TextBlock Text="Left Trigger" FontSize="14" FontWeight="SemiBold"
                                   Margin="0,0,0,12"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Dead Zone:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftTriggerDeadZone, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftTriggerDeadZone, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Anti-Dead Zone:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftTriggerAntiDeadZone, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftTriggerAntiDeadZone, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Live value bar -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="Live:" Style="{StaticResource DzLabel}"/>
                            <ProgressBar Value="{Binding LeftTrigger, Mode=OneWay}"
                                         Minimum="0" Maximum="1"
                                         Width="200" Height="16" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding RawLeftTrigger, Mode=OneWay}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <Separator Margin="0,12,0,12"/>

                        <!-- Right Trigger -->
                        <TextBlock Text="Right Trigger" FontSize="14" FontWeight="SemiBold"
                                   Margin="0,0,0,12"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Dead Zone:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightTriggerDeadZone, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightTriggerDeadZone, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Anti-Dead Zone:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightTriggerAntiDeadZone, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightTriggerAntiDeadZone, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="Live:" Style="{StaticResource DzLabel}"/>
                            <ProgressBar Value="{Binding RightTrigger, Mode=OneWay}"
                                         Minimum="0" Maximum="1"
                                         Width="200" Height="16" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding RawRightTrigger, Mode=OneWay}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ─── TAB 4: Force Feedback ─── -->
            <TabItem Header="Force Feedback">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
                    <StackPanel>
                        <TextBlock Text="Force Feedback / Rumble"
                                   FontSize="14" FontWeight="SemiBold" Margin="0,0,0,12"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                        <!-- Overall gain -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Overall Gain:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding ForceOverallGain, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding ForceOverallGain, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Left motor -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Left Motor:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding LeftMotorStrength, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding LeftMotorStrength, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Right motor -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Right Motor:" Style="{StaticResource DzLabel}"/>
                            <Slider Value="{Binding RightMotorStrength, Mode=TwoWay}"
                                    Style="{StaticResource DzSlider}"/>
                            <TextBlock Text="{Binding RightMotorStrength, StringFormat='{}{0}%'}"
                                       Style="{StaticResource DzValue}"/>
                        </StackPanel>

                        <!-- Swap motors -->
                        <CheckBox Content="Swap left/right motors"
                                  IsChecked="{Binding SwapMotors, Mode=TwoWay}"
                                  Margin="0,0,0,12"/>

                        <!-- Test rumble -->
                        <Button Content="Test Rumble"
                                Command="{Binding TestRumbleCommand}"
                                Padding="12,6" HorizontalAlignment="Left"
                                Margin="0,0,0,12"/>

                        <!-- Live motor display -->
                        <TextBlock Text="Motor Activity" FontWeight="SemiBold" Margin="0,8,0,8"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="Left Motor:" Style="{StaticResource DzLabel}"/>
                            <ProgressBar Value="{Binding LeftMotorDisplay, Mode=OneWay}"
                                         Minimum="0" Maximum="1"
                                         Width="200" Height="16" VerticalAlignment="Center"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="Right Motor:" Style="{StaticResource DzLabel}"/>
                            <ProgressBar Value="{Binding RightMotorDisplay, Mode=OneWay}"
                                         Minimum="0" Maximum="1"
                                         Width="200" Height="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ─── TAB 5: Macros ─── -->
            <TabItem Header="Macros">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <!-- Macro list -->
                        <ColumnDefinition Width="250"/>
                        <!-- Splitter -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- Macro editor -->
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Macro list -->
                    <DockPanel Grid.Column="0">
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                            <Button Content="Add" Command="{Binding AddMacroCommand}"
                                    Padding="8,4" Margin="0,0,4,0"/>
                            <Button Content="Remove" Command="{Binding RemoveMacroCommand}"
                                    Padding="8,4"/>
                        </StackPanel>

                        <ListBox ItemsSource="{Binding Macros}"
                                 SelectedItem="{Binding SelectedMacro, Mode=TwoWay}"
                                 DisplayMemberPath="Name"/>
                    </DockPanel>

                    <GridSplitter Grid.Column="1" Width="4" Margin="4,0"
                                  HorizontalAlignment="Center" VerticalAlignment="Stretch"
                                  ResizeBehavior="PreviousAndNext"/>

                    <!-- Macro editor (shows when a macro is selected) -->
                    <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto"
                                  Padding="8"
                                  DataContext="{Binding SelectedMacro}"
                                  Visibility="{Binding DataContext.HasSelectedMacro,
                                      RelativeSource={RelativeSource AncestorType=TabItem},
                                      Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <!-- Macro name -->
                            <TextBlock Text="Name" FontWeight="SemiBold" Margin="0,0,0,4"
                                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            <TextBox Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,0,12"/>

                            <!-- Enabled -->
                            <CheckBox Content="Enabled" IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                      Margin="0,0,0,12"/>

                            <!-- Trigger -->
                            <TextBlock Text="Trigger Combination" FontWeight="SemiBold"
                                       Margin="0,0,0,4"
                                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="{Binding TriggerDisplayText}"
                                           VerticalAlignment="Center" Margin="0,0,8,0"
                                           MinWidth="150"/>
                                <Button Content="{Binding RecordTriggerButtonText}"
                                        Command="{Binding RecordTriggerCommand}"
                                        Padding="8,4"/>
                            </StackPanel>

                            <!-- Trigger mode -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="Fire:" VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding TriggerMode, Mode=TwoWay}"
                                          SelectedValuePath="Tag" MinWidth="120">
                                    <ComboBoxItem Content="On Press" Tag="{x:Static vm:MacroTriggerMode.OnPress}"/>
                                    <ComboBoxItem Content="On Release" Tag="{x:Static vm:MacroTriggerMode.OnRelease}"/>
                                    <ComboBoxItem Content="While Held" Tag="{x:Static vm:MacroTriggerMode.WhileHeld}"/>
                                </ComboBox>
                            </StackPanel>

                            <CheckBox Content="Consume trigger buttons (hide from game)"
                                      IsChecked="{Binding ConsumeTriggerButtons, Mode=TwoWay}"
                                      Margin="0,0,0,12"/>

                            <!-- Action sequence -->
                            <TextBlock Text="Action Sequence" FontWeight="SemiBold"
                                       Margin="0,0,0,4"
                                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <Button Content="Add Action" Command="{Binding AddActionCommand}"
                                        Padding="8,4" Margin="0,0,4,0"/>
                                <Button Content="Remove" Command="{Binding RemoveActionCommand}"
                                        Padding="8,4"/>
                            </StackPanel>
                            <ListBox ItemsSource="{Binding Actions}"
                                     SelectedItem="{Binding SelectedAction, Mode=TwoWay}"
                                     DisplayMemberPath="DisplayText"
                                     MinHeight="100" MaxHeight="200" Margin="0,0,0,4"/>

                            <!-- Action editor (shows when an action is selected) -->
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                    BorderThickness="1" CornerRadius="4" Padding="8" Margin="0,0,0,12"
                                    DataContext="{Binding SelectedAction}"
                                    Visibility="{Binding DataContext.SelectedAction,
                                        RelativeSource={RelativeSource AncestorType=ScrollViewer},
                                        Converter={StaticResource NullToCollapsedConverter}}">
                                <StackPanel>
                                    <TextBlock Text="Edit Action" FontWeight="SemiBold" Margin="0,0,0,8"
                                               Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                                    <!-- Action type -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Type:" VerticalAlignment="Center"
                                                   Width="80" Margin="0,0,8,0"/>
                                        <ComboBox SelectedValue="{Binding Type, Mode=TwoWay}"
                                                  SelectedValuePath="Tag" MinWidth="150">
                                            <ComboBoxItem Content="Button Press" Tag="{x:Static vm:MacroActionType.ButtonPress}"/>
                                            <ComboBoxItem Content="Button Release" Tag="{x:Static vm:MacroActionType.ButtonRelease}"/>
                                            <ComboBoxItem Content="Key Press" Tag="{x:Static vm:MacroActionType.KeyPress}"/>
                                            <ComboBoxItem Content="Key Release" Tag="{x:Static vm:MacroActionType.KeyRelease}"/>
                                            <ComboBoxItem Content="Delay" Tag="{x:Static vm:MacroActionType.Delay}"/>
                                            <ComboBoxItem Content="Set Axis" Tag="{x:Static vm:MacroActionType.AxisSet}"/>
                                        </ComboBox>
                                    </StackPanel>

                                    <!-- Button flags (hex) — for ButtonPress / ButtonRelease -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Buttons:" VerticalAlignment="Center"
                                                   Width="80" Margin="0,0,8,0"/>
                                        <TextBox Text="{Binding ButtonFlags, Mode=TwoWay,
                                                     StringFormat=X4}" Width="80"/>
                                        <TextBlock Text="(hex flags: A=1000, B=2000, X=4000, Y=8000, LB=0100, RB=0200)"
                                                   VerticalAlignment="Center" Margin="8,0,0,0" FontSize="11"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>

                                    <!-- Key code — for KeyPress / KeyRelease -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Key Code:" VerticalAlignment="Center"
                                                   Width="80" Margin="0,0,8,0"/>
                                        <ComboBox ItemsSource="{x:Static vm:MacroAction.VirtualKeyValues}"
                                                  SelectedItem="{Binding SelectedVirtualKey, Mode=TwoWay}"
                                                  IsEditable="True" IsTextSearchEnabled="True"
                                                  MinWidth="180" MaxDropDownHeight="300"/>
                                    </StackPanel>

                                    <!-- Duration — for ButtonPress / KeyPress / Delay -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Duration:" VerticalAlignment="Center"
                                                   Width="80" Margin="0,0,8,0"/>
                                        <TextBox Text="{Binding DurationMs, Mode=TwoWay}" Width="80"/>
                                        <TextBlock Text="ms" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                    </StackPanel>

                                    <!-- Axis target + value — for AxisSet -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Axis:" VerticalAlignment="Center"
                                                   Width="80" Margin="0,0,8,0"/>
                                        <ComboBox SelectedValue="{Binding AxisTarget, Mode=TwoWay}"
                                                  SelectedValuePath="Tag" MinWidth="120">
                                            <ComboBoxItem Content="None" Tag="{x:Static vm:MacroAxisTarget.None}"/>
                                            <ComboBoxItem Content="Left Stick X" Tag="{x:Static vm:MacroAxisTarget.LeftStickX}"/>
                                            <ComboBoxItem Content="Left Stick Y" Tag="{x:Static vm:MacroAxisTarget.LeftStickY}"/>
                                            <ComboBoxItem Content="Right Stick X" Tag="{x:Static vm:MacroAxisTarget.RightStickX}"/>
                                            <ComboBoxItem Content="Right Stick Y" Tag="{x:Static vm:MacroAxisTarget.RightStickY}"/>
                                            <ComboBoxItem Content="Left Trigger" Tag="{x:Static vm:MacroAxisTarget.LeftTrigger}"/>
                                            <ComboBoxItem Content="Right Trigger" Tag="{x:Static vm:MacroAxisTarget.RightTrigger}"/>
                                        </ComboBox>
                                        <TextBlock Text="Value:" VerticalAlignment="Center"
                                                   Margin="12,0,8,0"/>
                                        <TextBox Text="{Binding AxisValue, Mode=TwoWay}" Width="80"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Repeat settings -->
                            <TextBlock Text="Repeat" FontWeight="SemiBold" Margin="0,0,0,4"
                                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="Mode:" VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <ComboBox SelectedValue="{Binding RepeatMode, Mode=TwoWay}"
                                          SelectedValuePath="Tag" MinWidth="120">
                                    <ComboBoxItem Content="Once" Tag="{x:Static vm:MacroRepeatMode.Once}"/>
                                    <ComboBoxItem Content="Fixed Count" Tag="{x:Static vm:MacroRepeatMode.FixedCount}"/>
                                    <ComboBoxItem Content="Until Release" Tag="{x:Static vm:MacroRepeatMode.UntilRelease}"/>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="Count:" VerticalAlignment="Center"
                                           Margin="0,0,8,0" Width="50"/>
                                <TextBox Text="{Binding RepeatCount, Mode=TwoWay}"
                                         Width="60"/>
                                <TextBlock Text="Delay (ms):" VerticalAlignment="Center"
                                           Margin="12,0,8,0"/>
                                <TextBox Text="{Binding RepeatDelayMs, Mode=TwoWay}"
                                         Width="60"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
